<!DOCTYPE html>
<script>
    $(function(){
        utils.ajax({
            url: "/menu/query",
            data: {type: '1'},
            async: false,
            success: function(r){
                var select = $("#menu-form select[name='pid']");
                $.each(r, function (i, n) {
                    select.append('<option value="'+n.id+'">'+n.name+'</option>');
                });
                var options = BootstrapDialog.getDialog("menu-dialog").options;
                if(options.data && options.data.pid){
                    select.val(options.data.pid);
                }
            }
        });
        var data = BootstrapDialog.getDialog("menu-dialog").options.data;
        $("#menu-form").bootstrapForm("load", {url: "/menu/detail", data: {id: data.id}});
        $("#menu-form").bootstrapForm("validForm", {
            url: "/menu/update",
            dialogId: "menu-dialog",
            submitBtnId: "menu-editBtn",
            fields: {
                name: {
                    validators: {
                        notEmpty: {message: '名称不能为空'}
                    }
                },
                seq: {
                    validators: {
                        notEmpty: {message: '排序不能为空'},
                        integer: {message: '排序为数字'}
                    }
                },
                url: {
                    validators: {
                        callback: {
                            message: "URL不能为空",
                            callback: function(fieldValue, validator){
                                var pid = $("#menu-form").find("select[name='pid']").val();
                                if(pid){
                                    if(fieldValue==""){
                                        return false;
                                    }
                                }
                                return true;
                            }
                        }
                    }
                },
                iconClass: {
                    validators: {
                        callback: {
                            message: "图标类型不能为空",
                            callback: function(fieldValue, validator){
                                var pid = $("#menu-form").find("select[name='pid']").val();
                                var visable = $("#menu-form").find("select[name='visable']").val();
                                if(!pid && visable=='1'){
                                    if(fieldValue==""){
                                        return false;
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
            },
            reValidateFields:["url","iconClass"],
            submitOnSuccess: function(r){
                if(r.success){
                    $('#menu-table').treegridData('reload');
                }
            }
        });
    });
</script>
<form id="menu-form" class="form-horizontal">
    <input type="hidden" name="id"/>
    <input type="hidden" name="_method" value="put"/><!--restful api put method-->
    <div class="form-group">
        <label class="col-lg-3 control-label">名称</label>
        <div class="col-lg-5">
            <input type="text" class="form-control" name="name" maxlength="32"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">URL</label>
        <div class="col-lg-5">
            <input type="text" class="form-control" name="url" maxlength="100"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">排序</label>
        <div class="col-lg-5">
            <input type="text" class="form-control" name="seq" maxlength="10"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">父级菜单</label>
        <div class="col-lg-5">
            <select type="text" class="form-control" name="pid">
                <option value="">请选择</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">权限代码</label>
        <div class="col-lg-5">
            <input type="text" class="form-control" name="authc" maxlength="30"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">图标样式类型</label>
        <div class="col-lg-5">
            <input type="text" class="form-control" name="iconClass" maxlength="20"/>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">状态</label>
        <div class="col-lg-5">
            <label><input type="radio" name="state" value="1"/>启用</label>
            <label><input type="radio" name="state" value="0"/>禁用</label>
        </div>
    </div>
    <div class="form-group">
        <label class="col-lg-3 control-label">可视</label>
        <div class="col-lg-5">
            <label><input type="radio" name="visable" value="1"/>是</label>
            <label><input type="radio" name="visable" value="0"/>否</label>
        </div>
    </div>
</form>
